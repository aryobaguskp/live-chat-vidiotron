<!DOCTYPE html>
<html lang="id">
<head>
  <title>Live Chat Café</title>
  <script src="/socket.io/socket.io.js"></script>

  <style>
    :root {
      --primary: #c69c6d;   /* WARNA BRAND CAFÉ */
      --secondary: #6b4f2c;
      --bg-dark: #0f0d0b;
    }

    body {
      background: linear-gradient(160deg, #1a1410, var(--bg-dark));
      color: #fff;
      font-family: "Segoe UI", Arial, sans-serif;
      font-size: 30px;
      margin: 0;
      padding: 30px;
      overflow: hidden;
    }

    /* HEADER */
    #header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      gap: 15px;
    }

    #logo {
  width: 80px;
  height: 80px;
  object-fit: contain;
  background: rgba(255,255,255,0.1);
  padding: 10px;
  border-radius: 16px;
  box-shadow: 0 0 20px rgba(198,156,109,0.6);
}


    #title {
      font-size: 36px;
      font-weight: 600;
      color: var(--primary);
      letter-spacing: 1px;
    }

    /* CONTAINER PESAN */
    #messages {
      max-height: 85vh;
      overflow: hidden;
      padding-right: 10px;
    }

    /* CHAT BUBBLE */
    .msg {
      background: rgba(255,255,255,0.06);
      border-left: 6px solid var(--primary);
      padding: 14px 20px;
      margin-bottom: 18px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);

      opacity: 0;
      transform: translateY(20px);
      animation: enter 0.6s cubic-bezier(0.25,0.8,0.25,1) forwards;
    }

    .username {
      color: var(--primary);
      font-weight: bold;
      margin-bottom: 6px;
      display: block;
      font-size: 22px;
    }

    /* ANIMASI MASUK */
    @keyframes enter {
      from {
        opacity: 0;
        transform: translateY(25px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ANIMASI KELUAR */
    .msg.exit {
      animation: exit 0.6s ease forwards;
    }

    @keyframes exit {
      from {
        opacity: 1;
        transform: translateY(0);
      }
      to {
        opacity: 0;
        transform: translateY(-20px);
      }
    }

    /* FOOTER HALUS */
    #footer {
      position: fixed;
      bottom: 10px;
      right: 20px;
      font-size: 14px;
      color: rgba(255,255,255,0.3);
    }
  </style>
</head>
<body>

<!-- HEADER -->
<div id="header">
  <img id="logo" src="/logo.png" alt="Logo Café">
  <div id="title">LIVE CHAT CAFÉ</div>
</div>

<!-- CHAT -->
<div id="messages"></div>

<div id="footer">Powered by Café Live System</div>

<script>
  const socket = io();
  const box = document.getElementById("messages");
  let renderedIds = new Set();

  function autoScroll() {
    box.scrollTo({
      top: box.scrollHeight,
      behavior: "smooth"
    });
  }

  function renderAll(msgs) {
    document.querySelectorAll(".msg").forEach(el => {
      const id = el.dataset.id;
      if (!msgs.find(m => m.id == id)) {
        el.classList.add("exit");
        setTimeout(() => el.remove(), 600);
        renderedIds.delete(id);
      }
    });

    msgs.forEach(m => {
      if (renderedIds.has(String(m.id))) return;

      const div = document.createElement("div");
      div.className = "msg";
      div.dataset.id = m.id;
      div.innerHTML = `
        <span class="username">${m.username}</span>
        ${m.message}
      `;
      box.appendChild(div);
      renderedIds.add(String(m.id));
    });

    autoScroll();
  }

  socket.on("refresh-messages", renderAll);

  socket.on("new-message", (msg) => {
    if (renderedIds.has(String(msg.id))) return;

    const div = document.createElement("div");
    div.className = "msg";
    div.dataset.id = msg.id;
    div.innerHTML = `
      <span class="username">${msg.username}</span>
      ${msg.message}
    `;
    box.appendChild(div);
    renderedIds.add(String(msg.id));

    autoScroll();
  });
</script>

</body>
</html>
