<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard</title>
<script src="/socket.io/socket.io.js"></script>

<style>
body{margin:0;font-family:Arial;background:#111;color:#fff}
#login{max-width:360px;margin:120px auto;background:#181818;padding:30px;border-radius:14px}
input{width:100%;padding:12px;margin-top:10px;border-radius:8px;border:none}
button{margin-top:12px;padding:10px 16px;border:none;border-radius:8px;background:#cfa35a;cursor:pointer}
button.secondary{background:#444}
#dashboard{display:none;padding:25px}
.card{background:#202020;padding:16px;border-radius:12px;margin-bottom:12px}
</style>
</head>

<body>

<div id="login">
  <h2>Admin Login</h2>
  <input id="pass" type="password" placeholder="Password admin">
  <button onclick="login()">Masuk</button>
  <div id="error"></div>
</div>

<div id="dashboard">
  <h2>Dashboard Admin</h2>
  <button onclick="approveAll()">Approve Semua</button>
  <div id="list"></div>
</div>

<script>
const socket = io();
const list = document.getElementById("list");
let busy = false;

function login(){
  socket.emit("admin-login", pass.value);
}

socket.on("login-success",()=>{
  login.style.display="none";
  dashboard.style.display="block";
});

socket.on("login-failed",()=>{
  error.innerText="Password salah";
});

socket.on("admin-refresh",(msgs)=>{
  busy = false;
  render(msgs);
});

function render(msgs){
  list.innerHTML="";
  msgs.forEach(m=>{
    const d=document.createElement("div");
    d.className="card";
    d.innerHTML=`
      <b>${m.username}</b><br>${m.message}<br>
      Status: ${m.approved?"✅ Approved":"⏳ Pending"}<br>
      <button onclick="approve(${m.id})">Approve</button>
      <button class="secondary" onclick="rejectMsg(${m.id})">Reject</button>
    `;
    list.appendChild(d);
  });
}

function approve(id){
  if(busy) return;
  busy=true;
  socket.emit("approve-message",id);
}

function rejectMsg(id){
  if(confirm("Hapus pesan ini?")){
    socket.emit("reject-message",id);
  }
}

function approveAll(){
  socket.emit("approve-all");
}
</script>

</body>
</html>
